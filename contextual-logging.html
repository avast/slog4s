<html><head><title>slog4s: Contextual logging</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Jan Strnad" /><meta name="description" content="Structured and contextual logging for Scala" /><meta name="og:image" content="/slog4s/img/poster.png" /><meta name="image" property="og:image" content="/slog4s/img/poster.png" /><meta name="og:title" content="slog4s: Contextual logging" /><meta name="title" property="og:title" content="slog4s: Contextual logging" /><meta name="og:site_name" content="slog4s" /><meta name="og:url" content="https://github.com/avast/slog4s" /><meta name="og:type" content="website" /><meta name="og:description" content="Structured and contextual logging for Scala" /><link rel="icon" type="image/png" href="/slog4s/img/favicon.png" /><meta name="twitter:title" content="slog4s: Contextual logging" /><meta name="twitter:image" content="https://avast.github.io/slog4s/img/poster.png" /><meta name="twitter:description" content="Structured and contextual logging for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/slog4s/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/slog4s/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/slog4s/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/slog4s/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/slog4s/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/slog4s/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/slog4s/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/slog4s/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/slog4s/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/slog4s/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/slog4s/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/slog4s/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/slog4s/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/slog4s/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/slog4s/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/slog4s/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/slog4s/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/slog4s/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/slog4s/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/slog4s/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/slog4s/highlight/styles/vs.css" /><link rel="stylesheet" href="/slog4s/css/pattern-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/slog4s/" class="brand"><div class="brand-wrapper"><span>slog4s</span></div></a></li> <li><a href="/slog4s/overview.html" class="">Overview</a></li> <li><a href="/slog4s/contextual-logging.html" class=" active ">Contextual logging</a></li> <li><a href="/slog4s/adt.html" class="">ADT support</a></li> <li><a href="/slog4s/integrations" class="">Integrations</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/avast/slog4s" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/avast/slog4s" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('slog4s Structured and contextual logging for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('slog4s Structured and contextual logging for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="avast" data-github-repo="slog4s"><div class="content-wrapper"><section><h1 id="contextual-logging">Contextual logging</h1>

<p>Contextual logging is provided by <code class="highlighter-rouge">LoggingContext</code> typeclass.</p>

<p><code class="highlighter-rouge">LoggingContext</code> is a typeclass, as its name suggest, provides propagation of logging context across multiple loggers and
log messages. It allows you to add additional arguments to all log messages produced inside given code block. Typical 
example is <code class="highlighter-rouge">Correlation-Id</code> (sometimes also known as <code class="highlighter-rouge">Trace-Id</code>) HTTP header. When an HTTP request comes in, we assign
unique random string to it (<code class="highlighter-rouge">Correlation-Id</code>). Using <code class="highlighter-rouge">LoggingContext</code> we can easily make sure that this string appears in
all log messages related to the HTTP request.</p>

<p>There are plenty use cases where you might want to include common argument in all related log messages: user id,
file name or any other entity.</p>

<p>Here is a simple example:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.Monad</span>
<span class="k">import</span> <span class="nn">cats.syntax.all._</span>
<span class="k">import</span> <span class="nn">slog._</span>

<span class="k">def</span> <span class="nf">foo</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:Monad:LoggingContext</span><span class="o">](</span><span class="n">loggerFactory</span><span class="k">:</span> <span class="kt">LoggerFactory</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">logger</span> <span class="k">=</span> <span class="nv">loggerFactory</span><span class="o">.</span><span class="py">make</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)</span>
    <span class="nc">LoggingContext</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="py">withArg</span><span class="o">(</span><span class="s">"correlation_id"</span><span class="o">,</span> <span class="s">"generated-correlation-id"</span><span class="o">)</span>
                     <span class="o">.</span><span class="py">use</span> <span class="o">{</span>
        <span class="nv">logger</span><span class="o">.</span><span class="py">info</span><span class="o">(</span><span class="s">"Hello from foo!"</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="nf">bar</span><span class="o">(</span><span class="n">loggerFactory</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">bar</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:LoggingContext</span><span class="o">](</span><span class="n">loggerFactory</span><span class="k">:</span> <span class="kt">LoggerFactory</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">logger</span> <span class="k">=</span> <span class="nv">loggerFactory</span><span class="o">.</span><span class="py">make</span><span class="o">(</span><span class="s">"bar"</span><span class="o">)</span>
    <span class="nv">logger</span><span class="o">.</span><span class="py">info</span><span class="o">(</span><span class="s">"Hellow from bar!"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>No we just need to get  <code class="highlighter-rouge">LoggingContext</code> and <code class="highlighter-rouge">LoggerFactory</code> instances. We will use slf4j module for that. We will also 
use <code class="highlighter-rouge">ReaderT[IO, Slf4jArgs, ?]</code> as our effect type because the implementation requires our effect implement 
<code class="highlighter-rouge">ApplicationLocal</code> typeclass. There are more efficient implementations for different effect types that relies on other
mechanisms (for curious ones: it <code class="highlighter-rouge">TaskLocal</code> for Monix and <code class="highlighter-rouge">FiberRef</code> for ZIO)</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.data._</span>
<span class="k">import</span> <span class="nn">cats.effect._</span>
<span class="k">import</span> <span class="nn">cats.mtl.instances.local._</span>
<span class="k">import</span> <span class="nn">slog.slf4j._</span>
<span class="k">type</span> <span class="kt">Result</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ReaderT</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Slf4jArgs</span>, <span class="kt">T</span><span class="o">]</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">loggingContext</span> <span class="k">=</span> <span class="nv">Slf4jContext</span><span class="o">.</span><span class="py">make</span><span class="o">[</span><span class="kt">Result</span><span class="o">]</span>
<span class="k">val</span> <span class="nv">loggerFactory</span> <span class="k">=</span> <span class="nc">Slf4jFactory</span><span class="o">[</span><span class="kt">Result</span><span class="o">].</span><span class="py">contextAsk</span><span class="o">.</span><span class="py">make</span>
</code></pre></div></div>

<p>No we can finally run it:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// we start with empty additional arguments</span>
<span class="nf">foo</span><span class="o">(</span><span class="n">loggerFactory</span><span class="o">).</span><span class="py">run</span><span class="o">(</span><span class="nv">Slf4jArgs</span><span class="o">.</span><span class="py">empty</span><span class="o">).</span><span class="py">unsafeRunSync</span><span class="o">()</span>
</code></pre></div></div>

<p>Output:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@timestamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-03T12:35:10.564Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"correlation_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"generated-correlation-id"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"level"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"INFO"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"level_value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">20000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"logger_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello from foo!"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"thread_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"run-main-0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"x-file"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"contextual-logging.md"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"x-line"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/slog4s/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
              </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/slog4s/js/main.js"></script></body></html>